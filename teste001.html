<html>
	<head>
		
	</head>
	<body>
	
	<script src="http://cdnjs.cloudflare.com/ajax/libs/three.js/r70/three.min.js"></script>
<script src="https://dl.dropboxusercontent.com/u/3587259/Code/Threejs/OrbitControls.js">
    
</script>
	<script src='https://jyunming-chen.github.io/WebAudio/js/shared.js'></script>

	<script>
	
		function BufferLoader(context, urlList, callback) {
		this.context = context;
		this.urlList = urlList;
		this.onload = callback;
		this.bufferList = new Array();
		this.loadCount = 0;
		}

		BufferLoader.prototype.loadBuffer = function(url, index) {
		// Load buffer asynchronously
		var request = new XMLHttpRequest();
		request.open("GET", url, true);
		request.responseType = "arraybuffer";

		var loader = this;

		request.onload = function() {
		// Asynchronously decode the audio file data in request.response
		loader.context.decodeAudioData(
		  request.response,
		  function(buffer) {
			if (!buffer) {
			  alert('error decoding file data: ' + url);
			  return;
			}
			loader.bufferList[index] = buffer;
			if (++loader.loadCount == loader.urlList.length)
			  loader.onload(loader.bufferList);
		  },
		  function(error) {
			console.error('decodeAudioData error', error);
		  }
		);
		}

		request.onerror = function() {
		alert('BufferLoader: XHR error');
		}

		request.send();
		}

		BufferLoader.prototype.load = function() {
		for (var i = 0; i < this.urlList.length; ++i)
		this.loadBuffer(this.urlList[i], i);
		}
	
	
	
	
	
	
	
	
	
	
	
	
	/*
	
		var context;
		window.addEventListener('load', init, false);
		function init() {
			try {
				// Fix up for prefixing
				window.AudioContext = window.AudioContext||window.webkitAudioContext;
				context = new AudioContext();
			}
			catch(e) {
				alert('Web Audio API is not supported in this browser');
			}
		}
		
		
		
		
		var dogBarkingBuffer = null;
		// Fix up prefixing
		window.AudioContext = window.AudioContext || window.webkitAudioContext;
		var context = new AudioContext();

		function loadDogSound(url) {
			var request = new XMLHttpRequest();
			request.open('GET', url, true);
			request.responseType = 'arraybuffer';

			// Decode asynchronously
			request.onload = function() {
				context.decodeAudioData(request.response, function(buffer) {
					dogBarkingBuffer = buffer;
				}, onError);
			}
			request.send();
		}
		
		
		
		
		// Fix up prefixing
		window.AudioContext = window.AudioContext || window.webkitAudioContext;
		var context = new AudioContext();

		function playSound(buffer) {
			var source = context.createBufferSource(); // creates a sound source
			source.buffer = buffer;                    // tell the source which sound to play
			source.connect(context.destination);       // connect the source to the context's destination (the speakers)
			source.start(0);                           // play the source now
			// note: on older systems, may have to use deprecated noteOn(time);
		}
		
		*/
		
		/*
		window.onload = init;
		var context;
		var bufferLoader;

		function init() {
			// Fix up prefixing
			window.AudioContext = window.AudioContext || window.webkitAudioContext;
			context = new AudioContext();

			bufferLoader = new BufferLoader(
				context,
				[
					'../a1.wav',
					'../a1.wav',
				],
				finishedLoading
			);

			bufferLoader.load();
		}

		function finishedLoading(bufferList) {
		// Create two sources and play them both together.
		var source1 = context.createBufferSource();
		var source2 = context.createBufferSource();
		source1.buffer = bufferList[0];
		source2.buffer = bufferList[1];

		source1.connect(context.destination);
		source2.connect(context.destination);
		source1.start(0);
		source2.start(0);
		}*/
		
		
		
		
	var RhythmSample = function () {
    loadSounds(this, {
        kick: 'https://jyunming-chen.github.io/WebAudio/kick.wav',
        snare: 'https://jyunming-chen.github.io/WebAudio/snare.wav',
        hihat: 'https://jyunming-chen.github.io/WebAudio/hihat.wav'
    });
};

RhythmSample.prototype.play = function () {
    // We'll start playing the rhythm 100 milliseconds from "now"
    var startTime = context.currentTime + 0.100;
    var tempo = 120; // BPM (beats per minute)
    var eighthNoteTime = (60 / tempo) / 2;

    // Play 2 bars of the following:
    for (var bar = 0; bar < 12; bar++) {
        var time = startTime + bar * 8 * eighthNoteTime;
        // Play the bass (kick) drum on beats 1, 5
        playSound(this.kick, time);
        playSound(this.kick, time + 4 * eighthNoteTime);

        // Play the snare drum on beats 3, 7
        playSound(this.snare, time + 2 * eighthNoteTime);
        playSound(this.snare, time + 6 * eighthNoteTime);

        // Play the hi-hat every eighthh note.
        for (var i = 0; i < 8; ++i) {
            playSound(this.hihat, time + i * eighthNoteTime);
        }
    }
};

/////////////////////////////////////////////////////////////////////////////////////////
var sample = new RhythmSample();
document.querySelector('button').addEventListener('click', function () {
    sample.play();
});
				
	</script>

	</body>
</html>
